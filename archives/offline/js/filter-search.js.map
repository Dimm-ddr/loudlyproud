{
  "version": 3,
  "sources": ["../../src/js/filter-search.ts"],
  "sourcesContent": ["import { Book } from \"../types\";\n\ndeclare global {\n  interface Window {\n    books: Book[];\n    Fuse: any; // Consider installing @types/fuse.js for better typing\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  const searchField = document.getElementById(\n    \"search-field\",\n  ) as HTMLInputElement;\n  const tagFilters = document.querySelectorAll<HTMLInputElement>(\".tag-filter\");\n  const authorFilters =\n    document.querySelectorAll<HTMLInputElement>(\".author-filter\");\n  const bookList = document.getElementById(\"book-gallery\") as HTMLDivElement; // Updated ID\n\n  const fuse = new window.Fuse(window.books, {\n    keys: [\"title\", \"authors\", \"tags\", \"book_description\"],\n    threshold: 0.4,\n  });\n\n  function getTagStyle(tag: string): {\n    bg: string;\n    text: string;\n    darkBg: string;\n    darkText: string;\n  } {\n    const normalizedTag = tag.toLowerCase().replace(/\\s+/g, \"-\"); // Assuming urlize replaces spaces with hyphens\n    const colorKey = window.tagMapping[normalizedTag] || \"fallback\";\n    return window.tagStyles[colorKey] || window.tagStyles[\"fallback\"];\n  }\n\n  function renderTags(tags: string[]): string {\n    return tags\n      .map((tag) => {\n        const style = getTagStyle(tag);\n        return `<span class=\"tag ${style.bg} ${style.text} dark:${style.darkBg} dark:${style.darkText}\">${tag}</span>`;\n      })\n      .join(\"\");\n  }\n\n  function renderBooks(filteredBooks: Book[]): void {\n    // Clear existing content\n    while (bookList.firstChild) {\n      bookList.removeChild(bookList.firstChild);\n    }\n\n    // Create document fragment for batch DOM updates\n    const fragment = document.createDocumentFragment();\n\n    filteredBooks.forEach((book) => {\n      const article = document.createElement(\"article\");\n      article.className =\n        \"book-card bg-secondary shadow-lg rounded-lg overflow-hidden transition duration-300 ease-in-out transform hover:shadow-xl flex flex-col\";\n\n      // Image Container\n      const imageContainer = document.createElement(\"div\");\n      imageContainer.className = \"h-64 overflow-hidden relative\";\n\n      const link = document.createElement(\"a\");\n      link.href = book.buy_link || \"#\";\n      link.className = \"block w-full h-full\";\n\n      const img = document.createElement(\"img\");\n      img.className =\n        \"w-full h-full object-contain transition-opacity duration-300\";\n      img.src = book.cover || \"/images/placeholder.webp\";\n      img.onerror = () => {\n        img.src = \"/images/placeholder.webp\";\n      };\n      img.alt = book.book_title;\n      img.loading = \"lazy\";\n\n      link.appendChild(img);\n      imageContainer.appendChild(link);\n\n      // Content Container\n      const content = document.createElement(\"div\");\n      content.className = \"p-4 flex flex-col flex-grow\";\n\n      const title = document.createElement(\"h2\");\n      title.className = \"text-xl font-black mb-2 text-primary\";\n\n      const titleLink = document.createElement(\"a\");\n      titleLink.href = book.buy_link || \"#\";\n      titleLink.className =\n        \"hover:underline focus:outline-none focus:ring-2 focus:ring-accent1 rounded\";\n      titleLink.textContent = book.book_title;\n\n      title.appendChild(titleLink);\n\n      // Tags Container\n      const tagsContainer = document.createElement(\"div\");\n      tagsContainer.className = \"flex flex-wrap gap-2\";\n\n      // Add tags\n      book.tags.forEach((tag) => {\n        const style = getTagStyle(tag);\n        const tagSpan = document.createElement(\"span\");\n        tagSpan.className = `tag ${style.bg} ${style.text} dark:${style.darkBg} dark:${style.darkText}`;\n        tagSpan.textContent = tag;\n        tagsContainer.appendChild(tagSpan);\n      });\n\n      // Assemble the components\n      content.appendChild(title);\n      content.appendChild(tagsContainer);\n      article.appendChild(imageContainer);\n      article.appendChild(content);\n      fragment.appendChild(article);\n    });\n\n    // Single DOM update\n    bookList.appendChild(fragment);\n  }\n\n  function applyFilters(): void {\n    let filteredBooks = window.books;\n\n    const selectedTags = Array.from(tagFilters)\n      .filter((checkbox) => checkbox.checked)\n      .map((checkbox) => checkbox.value);\n\n    const selectedAuthors = Array.from(authorFilters)\n      .filter((checkbox) => checkbox.checked)\n      .map((checkbox) => checkbox.value);\n\n    if (selectedTags.length) {\n      filteredBooks = filteredBooks.filter((book) =>\n        book.tags.some((tag) => selectedTags.includes(tag)),\n      );\n    }\n\n    if (selectedAuthors.length) {\n      filteredBooks = filteredBooks.filter((book) =>\n        book.authors.some((author) => selectedAuthors.includes(author)),\n      );\n    }\n\n    renderBooks(filteredBooks);\n  }\n\n  if (searchField) {\n    searchField.addEventListener(\"input\", (event) => {\n      const target = event.target as HTMLInputElement;\n      const results = fuse.search(target.value);\n      const filteredBooks = results.map((result: any) => result.item);\n      renderBooks(filteredBooks);\n    });\n  }\n\n  tagFilters.forEach((checkbox) =>\n    checkbox.addEventListener(\"change\", applyFilters),\n  );\n  authorFilters.forEach((checkbox) =>\n    checkbox.addEventListener(\"change\", applyFilters),\n  );\n\n  renderBooks(window.books);\n});\n"],
  "mappings": "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",
  "names": []
}
