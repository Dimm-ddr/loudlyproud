document.addEventListener("DOMContentLoaded",function(){let p=document.getElementById("search-field"),h=document.querySelectorAll(".tag-filter"),k=document.querySelectorAll(".author-filter"),r=document.getElementById("book-gallery"),b=new window.Fuse(window.books,{keys:["title","authors","tags","book_description"],threshold:.4});function w(t){let a=t.toLowerCase().replace(/\s+/g,"-"),n=window.tagMapping[a]||"fallback";return window.tagStyles[n]||window.tagStyles.fallback}function v(t){return t.map(a=>{let n=w(a);return`<span class="tag ${n.bg} ${n.text} dark:${n.darkBg} dark:${n.darkText}">${a}</span>`}).join("")}function m(t){for(;r.firstChild;)r.removeChild(r.firstChild);let a=document.createDocumentFragment();t.forEach(n=>{let e=document.createElement("article");e.className="book-card bg-secondary shadow-lg rounded-lg overflow-hidden transition duration-300 ease-in-out transform hover:shadow-xl flex flex-col";let o=document.createElement("div");o.className="h-64 overflow-hidden relative";let s=document.createElement("a");s.href=n.buy_link||"#",s.className="block w-full h-full";let l=document.createElement("img");l.className="w-full h-full object-contain transition-opacity duration-300",l.src=n.cover||"/images/placeholder.webp",l.onerror=()=>{l.src="/images/placeholder.webp"},l.alt=n.book_title,l.loading="lazy",s.appendChild(l),o.appendChild(s);let c=document.createElement("div");c.className="p-4 flex flex-col flex-grow";let u=document.createElement("h2");u.className="text-xl font-black mb-2 text-primary";let i=document.createElement("a");i.href=n.buy_link||"#",i.className="hover:underline focus:outline-none focus:ring-2 focus:ring-accent1 rounded",i.textContent=n.book_title,u.appendChild(i);let g=document.createElement("div");g.className="flex flex-wrap gap-2",n.tags.forEach(y=>{let d=w(y),f=document.createElement("span");f.className=`tag ${d.bg} ${d.text} dark:${d.darkBg} dark:${d.darkText}`,f.textContent=y,g.appendChild(f)}),c.appendChild(u),c.appendChild(g),e.appendChild(o),e.appendChild(c),a.appendChild(e)}),r.appendChild(a)}function E(){let t=window.books,a=Array.from(h).filter(e=>e.checked).map(e=>e.value),n=Array.from(k).filter(e=>e.checked).map(e=>e.value);a.length&&(t=t.filter(e=>e.tags.some(o=>a.includes(o)))),n.length&&(t=t.filter(e=>e.authors.some(o=>n.includes(o)))),m(t)}p&&p.addEventListener("input",t=>{let a=t.target,e=b.search(a.value).map(o=>o.item);m(e)}),h.forEach(t=>t.addEventListener("change",E)),k.forEach(t=>t.addEventListener("change",E)),m(window.books)});
