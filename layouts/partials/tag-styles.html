{{ $colors := site.Data.colors.colors }}
{{ $tagMapping := site.Data.tag_mapping.tag_colors }}
{{ $fallback := $colors.fallback }}

{{ define "getTagStyle" }}
  {{ $tag := .tag }}
  {{ $colors := .colors }}
  {{ $mapping := .mapping }}
  {{ $fallback := .fallback }}

  {{ $normalizedTag := $tag | lower | urlize }}
  {{ $colorKey := index $mapping $normalizedTag | default "fallback" }}
  {{ $style := index $colors $colorKey | default $fallback }}

  {{ return $style }}
{{ end }}

{{ define "renderTag" }}
  {{ $tagStyle := partial "getTagStyle" (dict "tag" .tag "colors" .colors "mapping" .mapping "fallback" .fallback) }}
  <span class="tag {{ $tagStyle.bg }} {{ $tagStyle.text }} dark:{{ $tagStyle.dark.bg }} dark:{{ $tagStyle.dark.text }}">
    {{ .tag }}
  </span>
{{ end }}

<!-- Debug Tag Styles -->
<div class="bg-green-100 p-1 m-1">
    <p>Tag Styles Debug:</p>
    <p>Input tag: {{ printf "%#v" .tag }}</p>
    <p>Colors: {{ printf "%#v" .colors }}</p>
    <p>Mapping: {{ printf "%#v" .mapping }}</p>
    <p>Fallback: {{ printf "%#v" .fallback }}</p>
</div>