{{/* Cache tag registry lookup */}}
{{ $input := .tag | string }}
{{ $lookupKey := $input | lower }}

{{/* Use cached registry data */}}
{{ $registryData := site.Data.tags.tags_registry }}
{{ $tagData := index $registryData.tags $lookupKey | default dict }}

{{ $normalizedTag := $tagData.internal | default ($input | urlize) }}
{{ $displayTag := $tagData.display | default $input }}
{{ $colorKey := $tagData.color | default "fallback" }}

<!-- Use normalized tag for URL -->
{{ $tagURL := path.Join "/tags" $normalizedTag | relLangURL }}

<a
    href="{{ $tagURL }}"
    class="inline-block px-3 py-1 rounded-full text-sm font-bold transition-colors duration-200"
    data-tag="{{ $normalizedTag }}"
    data-color="{{ $colorKey }}"
    x-data="{ colorKey: '{{ $colorKey }}' }"
    x-cloak
    :class="$store.tagStyles[colorKey]"
>
    {{ $displayTag | safeHTML }}
</a>